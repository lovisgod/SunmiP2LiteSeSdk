package com.lovisgod.sunmip2litese.utils.AidHelpers

import com.lovisgod.sunmip2litese.SunmiLiteSeApplication.securityOptV2
import com.lovisgod.sunmip2litese.SunmiLiteSeApplication.emvOptV2
import com.lovisgod.sunmip2litese.utils.AidHelpers.EmvUtil
import com.sunmi.pay.hardware.aidlv2.security.SecurityOptV2
import com.lovisgod.sunmip2litese.SunmiLiteSeApplication
import com.lovisgod.sunmip2litese.utils.ByteUtil
import com.sunmi.pay.hardware.aidlv2.AidlConstantsV2
import com.sunmi.pay.hardware.aidlv2.emv.EMVOptV2
import com.lovisgod.sunmip2litese.utils.AidHelpers.AIDmapper
import com.lovisgod.sunmip2litese.utils.Constants
import com.lovisgod.sunmip2litese.utils.IswHpCodes
import com.lovisgod.sunmip2litese.utils.LogUtil
import com.sunmi.pay.hardware.aidl.AidlConstants
import com.sunmi.pay.hardware.aidlv2.bean.EmvTermParamV2
import java.lang.Exception
import java.util.HashMap

object EmvUtil {
    val Constant = Constants
    const val COUNTRY_CHINA = "China"
    const val COUNTRY_RUSSIA = "Russia"
    const val COUNTRY_INDIA = "India"

    /**
     * Config country code,capability,transaction currency code,transaction currency code exponent
     * <br></br> Client should config their own data according their country.
     */
    fun getConfig(country: String?): Map<String, String> {
        val map: MutableMap<String, String> = HashMap()
        when (country) {
            COUNTRY_RUSSIA -> {
                map["countryCode"] = "0643"
                map["capability"] = "E0F8C8"
                map["5F2A"] = "0643"
                map["5F36"] = "00"
            }
            COUNTRY_INDIA -> {
                map["countryCode"] = "0356"
                map["capability"] = "E0F8C8"
                map["5F2A"] = "0356"
                map["5F36"] = "02"
            }
            COUNTRY_CHINA -> {
                map["countryCode"] = "0156" // country code(国家代码)
                map["capability"] = "E0F8C8" // capability(终端性能)
                map["5F2A"] = "0156" // transaction currency code(交易货币代码)
                map["5F36"] = "00" // transaction currency code exponent(交易货币代码指数)
            }
            else -> {
                map["countryCode"] = "0156"
                map["capability"] = "E0F8C8"
                map["5F2A"] = "0156"
                map["5F36"] = "00"
            }
        }
        return map
    }

    /**
     * Initialize keys.
     * <br></br>Client App should save their own keys.
     */
    fun initKey() {
        try {
            val mSecurityOptV2 = securityOptV2
            val cvByte = ByteUtil.hexStr2Bytes("82E13665B4624DF5")

            // save KEK
            var dataByte = ByteUtil.hexStr2Bytes("11111111111111111111111111111111")
            var result = mSecurityOptV2!!.savePlaintextKey(
                AidlConstants.Security.KEY_TYPE_KEK,
                dataByte,
                cvByte,
                AidlConstants.Security.KEY_ALG_TYPE_3DES,
                10
            )
            LogUtil.e(Constants.TAG, "save KEK result:$result")
            if (result != 0) {
                LogUtil.e(Constant.TAG, "save KEK fail")
                return
            }

            // save TMK
            dataByte = ByteUtil.hexStr2Bytes("F40379AB9E0EC533F40379AB9E0EC533")
            result = mSecurityOptV2.saveCiphertextKey(
                AidlConstants.Security.KEY_TYPE_TMK,
                dataByte,
                cvByte,
                10,
                AidlConstants.Security.KEY_ALG_TYPE_3DES,
                11
            )
            LogUtil.e(Constant.TAG, "save TMK result:$result")
            if (result != 0) {
                LogUtil.e(Constant.TAG, "save TMK fail")
                return
            }

            // save PIK
            result = mSecurityOptV2.saveCiphertextKey(
                AidlConstants.Security.KEY_TYPE_PIK,
                dataByte,
                cvByte,
                11,
                AidlConstants.Security.KEY_ALG_TYPE_3DES,
                12
            )
            LogUtil.e(Constant.TAG, "save PIK result:$result")
            if (result != 0) {
                LogUtil.e(Constant.TAG, "save PIK fail")
                return
            }

            // save MAK
            result = mSecurityOptV2.saveCiphertextKey(
                AidlConstants.Security.KEY_TYPE_MAK,
                dataByte,
                cvByte,
                11,
                AidlConstants.Security.KEY_ALG_TYPE_3DES,
                13
            )
            LogUtil.e(Constant.TAG, "save MAK result:$result")
            if (result != 0) {
                LogUtil.e(Constant.TAG, "save MAK fail")
                return
            }

            // save TDK
            result = mSecurityOptV2.saveCiphertextKey(
                AidlConstants.Security.KEY_TYPE_TDK,
                dataByte,
                cvByte,
                11,
                AidlConstants.Security.KEY_ALG_TYPE_3DES,
                14
            )
            LogUtil.e(Constant.TAG, "save TDK result:$result")
            if (result != 0) {
                LogUtil.e(Constant.TAG, "save TDK fail")
                return
            }
            LogUtil.e(Constant.TAG, "init key success")
        } catch (e: Exception) {
            e.printStackTrace()
            LogUtil.e(Constant.TAG, "init key fail")
        }
    }

    /**
    *
    *
    * clear capk
    * **/
    fun clearCapk(): Int {
        return try {
            val emvOptV2 = emvOptV2
            // clear SDK built-in CAPKs
            val ret  = emvOptV2!!.deleteCapk(null, null)
            LogUtil.e(Constant.TAG, "clear CAPKs success")
            ret
        } catch (e: Exception) {
            e.printStackTrace()
            LogUtil.e(Constant.TAG, "clear capkfail")
            IswHpCodes.GENERAL_EMV_EXCEPTION
        }
    }

    /**
     *
     *
     * clear AID
     * **/
    fun clearAid(): Int {
        return try {
            val emvOptV2 = emvOptV2
            // clear SDK built-in CAPKs
            val ret  = emvOptV2!!.deleteAid(null)
            LogUtil.e(Constant.TAG, "clear AID success")
            ret
        } catch (e: Exception) {
            e.printStackTrace()
            LogUtil.e(Constant.TAG, "clear AID fail")
            IswHpCodes.GENERAL_EMV_EXCEPTION
        }
    }

    /**
     * Initialize RIDs.
     */
    fun initCapk() {
        try {
            val emvOptV2 = emvOptV2
            AIDmapper().getAllCapk(emvOptV2)
            LogUtil.e(Constant.TAG, "init  CAPKs success")
        } catch (e: Exception) {
            e.printStackTrace()
            LogUtil.e(Constant.TAG, "initCapk fail")
        }
    }

    /**
     * Initialize AIDs.
     *
     */
    fun initAid() {
        try {
            val emvOptV2 = emvOptV2
            AIDmapper().getAllAid(emvOptV2)
            LogUtil.e(Constant.TAG, "init AID success")
        } catch (e: Exception) {
            e.printStackTrace()
            LogUtil.e(Constant.TAG, "initAID fail")
        }
    }




    /**
     * Set EMV terminal parameters.
     * <br></br> Client app should save their own terminal parameters
     */
    fun setTerminalParam(map: Map<String?, String?>) {
        try {
            val emvOptV2 = emvOptV2
            val emvTermParam = EmvTermParamV2()
            emvTermParam.countryCode = map["countryCode"]
            emvTermParam.capability = map["capability"]
            emvTermParam.currencyCode = map.get("currencyCode");
            emvTermParam.currencyExp = map.get("currencyExponent");
            val result = emvOptV2!!.setTerminalParam(emvTermParam)
            LogUtil.e("Terminal Param", "setTerminalParam result:$result")
        } catch (e: Exception) {
            e.printStackTrace()
            LogUtil.e("Terminal Param", "setTerminalParam fail")
        }
    }
    /**
     * Initialize NFC-Speedup aid and rid
     */
    //    public static void initNFCSpeedupAidAndRid() {
    //        try {
    //            EMVOptV2 emvOptV2 = SunmiLiteSeApplication.INSTANCE.getEmvOptV2();
    //            // clea Aid and Capk
    //            emvOptV2.deleteAid(null);
    //            emvOptV2.deleteCapk(null, null);
    //
    //            //BCTC AIDs
    //            AidV2 aid = EmvUtil.hexStr2Aid("9F0607A0000003330101DF010101DF11050000000000DF12050000000000DF13050000000000DF14039F3704DF150400000000DF160100DF1701009F1B04000027109F090200309F150212349F160F3030303030303030303030303030309F4E085465726D696E616C9F1C0846726F6E743132339F1D01015F3601029F3C020840DF81010208409F3D0102DF8102039F37045F2A0208409F010512345678919F7B06000000020000DF1906000000015000DF2006000000020000DF2106000000010000DFC1080101");
    //            emvOptV2.addAid(aid);
    //            aid = EmvUtil.hexStr2Aid("9F0610A0000003330101010203040506070809DF010101DF11050000000000DF12050000000000DF13050000000000DF14039F3704DF150400000000DF160100DF1701009F1B04000027109F090200309F150212349F160F3030303030303030303030303030309F4E085465726D696E616C9F1C0846726F6E743132339F1D01015F3601029F3C020840DF81010208409F3D0102DF8102039F37045F2A0208409F010512345678919F7B06000000010000DF1906000000015000DF2006000000020000DF2106000000010000DFC1080101");
    //            emvOptV2.addAid(aid);
    //            aid = EmvUtil.hexStr2Aid("9F0608A000000333010102DF010101DF11050020000000DF12050020000000DF13050020000000DF14039F3704DF150400000000DF160100DF1701009F1B04000027109F090200309F150212349F160F3030303030303030303030303030309F4E085465726D696E616C9F1C084261636B393631329F1D01015F3601029F3C020840DF81010208409F3D0102DF8102039F37045F2A0208409F010512345678919F7B06000000010000DF1906000000015000DF2006000000020000DF2106000000010000DFC1080101");
    //            emvOptV2.addAid(aid);
    //            aid = EmvUtil.hexStr2Aid("9F0607A0000000031010DF010101DF11050000000000DF12050000000000DF13050000000000DF14039F3704DF150400000000DF160100DF1701009F1B04000150009F090200969F150212349F160F3030303030303030303030303030309F4E0653484F5020319F1C0846726F6E743132339F1D01015F3601029F3C020840DF81010208409F3D0102DF8102039F37045F2A0208409F01060123456789109F7B06000000010000DF1906000000015000DF2006000000020000DF2106000000010000DFC1080101");
    //            emvOptV2.addAid(aid);
    //            aid = EmvUtil.hexStr2Aid("9F0608A000000003101003DF010101DF11050000000000DF12050000000000DF13050000000000DF14039F3704DF150400000000DF160100DF1701009F1B04000150009F090200969F150212349F160F3030303030303030303030303030309F4E0653484F5020319F1C0846726F6E743132339F1D01015F3601029F3C020840DF81010208409F3D0102DF8102039F37045F2A0208409F010512345678919F7B06000000010000DF1906000000015000DF2006000000020000DF2106000000010000DFC1080101");
    //            emvOptV2.addAid(aid);
    //            aid = EmvUtil.hexStr2Aid("9F0608A000000003101004DF010101DF11050000000000DF12050000000000DF13050000000000DF14039F3704DF150400000000DF160100DF1701009F1B04000027109F090200969F150212349F160F3030303030303030303030303030309F4E085465726D696E616C9F1C0846726F6E743132339F1D01015F3601029F3C020840DF81010208409F3D0102DF8102039F37045F2A0208409F010512345678919F7B06000000010000DF1906000000015000DF2006000000020000DF2106000000010000DFC1080101");
    //            emvOptV2.addAid(aid);
    //            aid = EmvUtil.hexStr2Aid("9F0608A000000003101005DF010101DF11050000000000DF12050000000000DF13050000000000DF14039F3704DF150400000000DF160100DF1701009F1B04000027109F090200969F150212349F160F3030303030303030303030303030309F4E085465726D696E616C9F1C0846726F6E743132339F1D01015F3601029F3C020840DF81010208409F3D0102DF8102039F37045F2A0208409F010512345678919F7B06000000010000DF1906000000015000DF2006000000020000DF2106000000010000DFC1080101");
    //            emvOptV2.addAid(aid);
    //            aid = EmvUtil.hexStr2Aid("9F0608A000000003101006DF010101DF11050000000000DF12050000000000DF13050000000000DF14039F3704DF150400000000DF160100DF1701009F1B04000027109F090200969F150212349F160F3030303030303030303030303030309F4E085465726D696E616C9F1C0846726F6E743132339F1D01015F3601029F3C020840DF81010208409F3D0102DF8102039F37045F2A0208409F010512345678919F7B06000000010000DF1906000000015000DF2006000000020000DF2106000000010000DFC1080101");
    //            emvOptV2.addAid(aid);
    //            aid = EmvUtil.hexStr2Aid("9F0608A000000003101007DF010101DF11050000000000DF12050000000000DF13050000000000DF14039F3704DF150400000000DF160100DF1701009F1B04000027109F090200969F150212349F160F3030303030303030303030303030309F4E085465726D696E616C9F1C0846726F6E743132339F1D01015F3601029F3C020840DF81010208409F3D0102DF8102039F37045F2A0208409F010512345678919F7B06000000010000DF1906000000015000DF2006000000020000DF2106000000010000DFC1080101");
    //            emvOptV2.addAid(aid);
    //            aid = EmvUtil.hexStr2Aid("9F0607A0000000999090DF010101DF11050000000000DF12050000000000DF13050000000000DF14039F3704DF150400000000DF160100DF1701009F1B04000027109F090200099F150212349F160F3030303030303030303030303030309F4E085465726D696E616C9F1C0846726F6E743132339F1D01015F3601029F3C020840DF81010208409F3D0102DF8102039F37045F2A0208409F010512345678919F7B06000000010000DF1906000000015000DF2006000000020000DF2106000000010000DFC1080101");
    //            emvOptV2.addAid(aid);
    //            aid = EmvUtil.hexStr2Aid("9F0606A00000999901DF010101DF11050000000000DF12050000000000DF13050000000000DF14039F3704DF150400000000DF160100DF1701009F1B04000027109F090299999F150212349F160F3030303030303030303030303030309F4E085465726D696E616C9F1C0846726F6E743132339F1D01015F3601029F3C020840DF81010208409F3D0102DF8102039F37045F2A0208409F010512345678919F7B06000000010000DF1906000000015000DF2006000000020000DF2106000000010000DFC1080101");
    //            emvOptV2.addAid(aid);
    //            aid = EmvUtil.hexStr2Aid("9F0607A0000000041010DF010101DF11050000000000DF12050000000000DF13054000000000DF14039F3704DF150400000000DF160100DF1701009F1B04000200009F090200029F150213429F160F3030303030303030303030303030309F4E0653484F5020329F1C084261636B313233349F1D01015F3601039F3C020056DF81010208409F3D0102DF8102039F37045F2A0208409F010512345678919F7B06000000010000DF1906000000015000DF2006000000020000DF2106000000010000DFC1080101");
    //            emvOptV2.addAid(aid);
    //
    //            // BCTC RIDs
    //            CapkV2 capkV2 = EmvUtil.hexStr2Rid("9F0605A0000003339F220180DF0803000000DF050420201231DF060101DF070100DF028180CCDBA686E2EFB84CE2EA01209EEB53BEF21AB6D353274FF8391D7035D76E2156CAEDD07510E07DAFCACABB7CCB0950BA2F0A3CEC313C52EE6CD09EF00401A3D6CC5F68CA5FCD0AC6132141FAFD1CFA36A2692D02DDC27EDA4CD5BEA6FF21913B513CE78BF33E6877AA5B605BC69A534F3777CBED6376BA649C72516A7E16AF85DF0403010001DF031498B7628CC6111866270DB8F941B234238959EFEF");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("9F0605A0000003339F220105DF0803000000DF050420201231DF060101DF070100DF0281F897CF8BAD30CAE0F9A89285454DDDE967AAFBCD4BC0B78F29ECB1005286F15F6D7532A9C476607C73FF7424316DFC741894AA52EDBAF909719C7B53448343B45CF2F00A8ABFB78CEEBE848933AAED97DBE84F0730F34FB1AA1528D3D6EC75B73252A30D0C717518BE36458ADD0FBF854C65497F3F54084154B60F51561361EE8E85F742A54005524CB00FEBC334276E0E63DAD86C079A9A3DF5DD32BECADE1AB2B71F5F0A0E95A4000D01F1044A578AAD92E9FDE92E3C6AA3DCD4913DFA5552537E7DE75E241FAED455D76CB8FCAFEED3FD6DAB24D7A9C32852F866C751D7710F494A0DF11B67FAECDD87A9A4E2CC44F6F27E46E3C0CCCD0FDF040103DF0314852123384D643A0FB10500AA4462C14EC16A87E7");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("f9F0605A0000003339F220157DF0803000000DF050420201231DF060104DF070101DF0240E8105E77861FD2EB727C84E36D3D4A5666BD0ADCE8781F0145D3D82D72B92748E22D5404C6C41F3EC8B790DE2F61CF29FAECB168C79F5C8666762D53CC26A460DF040101DF0314E3A795C1AC809B0AAFE1157C4C44366454AA0750");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("f9F0605A0000003339F220158DF0803000000DF050420201231DF060104DF070101DF0240FFC2B1513320C275411DBADD2188203F7B62519F8C7BA98EF8AA9FD6D2E475984E383C3E12784B42B066960EEA0C8FC8099E14128055D67A666CCA5A058C26A4DF040101DF03146A51EE242553FDD4F1E5C5FB958DFAB156B98FB3");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("9F0605A0000000039F220157DF0803000000DF050420201231DF060101DF070100DF0260942B7F2BA5EA307312B63DF77C5243618ACC2002BD7ECB74D821FE7BDC78BF28F49F74190AD9B23B9713B140FFEC1FB429D93F56BDC7ADE4AC075D75532C1E590B21874C7952F29B8C0F0C1CE3AEEDC8DA25343123E71DCF86C6998E15F756E3DF0403010001DF0314FC215F38BDCF12CC8E3B608E4058F4E4A58D4927");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("9F0605A0000003339F2201C0DF0803000000DF050420201231DF060101DF070100DF028190C7CDB6F2A3FE80A8834CDDDD326E1082AA2288F47C464D57B34718193431711A44119148055044CFE3313708BED0C98E1C589B0F53CF6D7E829FCD906D21A90FD4CB6BAF13110C4685107C27E00981DB29DC0AC186E6D701577F23865626244E1F9B2CD1DDFCB9E899B41F5084D8CCC178A7C3F4546CF93187106FAB055A7AC67DF62E778CB88823BA58CF7546C2B09FDF0403010001DF0314673AEF0889514D24856E066080AFC45BE1C65E64");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("9F0605A0000003339F2201C1DF0803000000DF050420201231DF060101DF070100DF0281F892F083CBE46F8DCC0C04E498BA9952BA9D4C09C80DD277E579F07E45772846FA43DD3AB31CC6B08DD18695715949FB108E53A071D393A7FDDBF9C5FB0B0507138797317480FC48D633ED38B401A451443AD7F15FACDA45A62ABE24FF6343ADD0909EA8389348E54E26F842880D1A69F9214368BA30C18DE5C5E0CB9253B5ABC55FB6EF0A738D927494A30BBF82E340285363B6FAA15673829DBB210E710DA58EE9E578E7CE55DC812AB7D6DCCE0E3B1AE179D664F3356EB951E3C91A1CBBF6A7CA8D0C7EC9C6AF7A4941C5051099B9784E56C9162067B8C3B15C5FA4480A645CD2526A69C80BA8EF361BE2AA9417DEFCE35B62B0C9CF097DDF0403010001DF0314C024AF20769619E55E5FD4A0E445068BEE061988");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("9F0605A0000003339F220161DF0803000000DF050420201231DF060101DF070100DF028180834D2A387C5A5F176EF3E66CAAF83F194B15AAD2470C78C77D6EB38EDAE3A2F9BA1623F6A58C892CC925632DFF48CE954B21A53E1F1E4366BE403C279B90027CBC72605DB6C79049B8992CB4912EFA270BECAB3A7CEFE05BFA46E4C7BBCF7C7A173BD988D989B32CB79FAC8E35FBE1860E7EA9F238A92A3593552D03D1E38601DF040103DF0314008C4830309F455E0FF9EB406EF5F1FE92BFAB5E");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("9F0605A0000003339F220162DF0803000000DF050420201231DF060101DF070100DF028180B5CDD1E5368819FC3EA65B80C68117BBC29F9096EBD217269B583B0745E0C16433D54B8EF387B1E6CDDAED4923C39E370E5CADFE041773023A6BC0A033B0031B0048F18AC159773CB6695EE99F551F414883FB05E52640E893F4816082241D7BFA3640960003AD7517895C50E184AA956367B7BFFC6D8616A7B57E2D447AB3E1DF0403010001DF031427DD170AE3B3CA6FFF3D8B70FAF861E278821680");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("9F0605A0000003339F220163DF0803000000DF050420201231DF060101DF070100DF028190867ECA26A57472DEFB6CA94289312BA39C63052518DC480B6ED491ACC37C028846F4D7B79AFAEEFA07FB011DAA46C06021E932D501BF52F2834ADE3AC7689E94B248B28F3FE2803669DEDA000988DA1249F9A891558A05A1E5A7BD2C282FE18D204189A9994D4ADD86C0CE50952ED8BCEC0CE633679188285E51E1BED840FCBFC10953939AF49DB90048912E48B44181DF040103DF031403D2F503802D2F0FFBCC6FC5A188BCC3920601A4");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("9F0605A0000003339F220164DF0803000000DF050420201231DF060101DF070100DF0281A091123ECF0230E3CB245C88DDFA3EE57BC58ED00B367B3875FCB79548872680F601E8C839AC0721BAB3B89ED21607281C8919BF726266EAB848502AD874B5107A4E654EF6D37773343F461435C86E4A8F866FB18C7CBA497B426290C38D196E2AFF33C0906F9296F297E156DC602A5E653CA1168F1109261114BF7BE8127A3E8007191830134299395CE2B322228667B76E072EB7FD5D0FB3A83E8AD1D7F6FD81DF040103DF03147ADC11ED326AB9D2B758C3EC753EB0FAFA680AA7");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("9F0605A0000003339F220165DF0803000000DF050420201231DF060101DF070100DF0281B081BA1E6B9F671CFC848CA2ACD8E17AF406B4D329D1ECA5D01BC094A87C30AF49867944C632E8185074655FA535AD8CA42A83B41AAAEA859F432FA0B818E72DC07ED3F77FB318A475A261C0760A156E5DDC157AE8B79BA72D89D69FFF754619E928F1516A2A72C0F86B09B8EA25F86DC5A48EBC5A16F83FBA8FC4E3A98278912249F4E079BCBC06E7BED9AED397879D279ED91925394901260949BCCE6FA1169798A2715DAE32988BEFBE9621AE15E0C1DF0403010001DF03145D3B1D475575F920A3CCAC9BB5B9B57AC5B7F335");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("9F0605A0000003339F220166DF0803000000DF050420201231DF060101DF070100DF02607F5A3945794D6B15F5F26B4A21A63A5EF35540D8C8C099151F2279780A5C18A317703C98632E804D25576A7B460C05061E03975E50FBD7495B3ADC8E425E53DF76FA40B035E87F69ABF8765A52523F3B1A39B19528B002239015FADBA5921051DF0403010001DF03143D22F31392CFE70D21B0C6729CCCACBA9288181A");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("9F0605A0000003339F220168DF0803000000DF050420201231DF060101DF070100DF0281F883B7D2D657DD591370341651E13A893E28680A958F41462A2E358B0DBDD2FD0E6E6F006C857C2EFBC25362CD77D72AAA01F87F66A131ED95546B8AA422CBA017C0875C2BA83A755F5861921D276587080AD46A81AF08B1148DC9EA10AB06B0B6619D29063D048F9A01F4F835998D0B8C3C500578A6599C63CAADB7160CBFE68D6C16ABBF0C02B44781A83FDB19B6755E84C478181F41B81C8826E711687965DFF7CBC433A3229B53AD35C1222313CEBEC22B9E76AB249A99A088C8F3D7E726A7C5A0C921BE6C05A76DF641A1E707A6A195F56D6C9DA311B181618ED93354BF19717CF8D06FA4B4F1F29BC5BD145AEA43824AEA8C46E2E5D1DF0403010001DF0314B5BC6B91C3FAAADD1C49087536F102548CA88F7B");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("9F0605A0000099999F2201E1DF0803000000DF050420201231DF060101DF070100DF027099C5B70AA61B4F4C51B6F90B0E3BFB7A3EE0E7DB41BC466888B3EC8E9977C762407EF1D79E0AFB2823100A020C3E8020593DB50E90DBEAC18B78D13F96BB2F57EEDDC30F256592417CDF739CA6804A10A29D2806E774BFA751F22CF3B65B38F37F91B4DAF8AEC9B803F7610E06AC9E6BDF040103DF03142953215B820734A737A812C12F9B9C0D85B288C7");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("9F0605A0000099999F2201E2DF0803000000DF050420201231DF060101DF070100DF0270BD232E348B118EB3F6446EF4DA6C3BAC9B2AE510C5AD107D38343255D21C4BDF4952A42E92C633B1CE4BFEC39AFB6DFE147ECBB91D681DAC15FB0E198E9A7E4636BDCA107BCDA3384FCB28B06AFEF90F099E7084511F3CC010D4343503E1E5A67264B4367DAA9A3949499272E9B5022FDF040103DF03141844877C9253299BC59CCA14D8D79EEEE0E0DCFA");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("9F0605A0000099999F2201E3DF0803000000DF050420201231DF060101DF070100DF0270BC01E12223E1A41E88BFFA801093C5F8CEC5CD05DBBDBB787CE87249E8808327C2D218991F97A1131E8A25B0122ED11E709C533E8886A1259ADDFDCBB396604D24E505A2D0B5DD0384FB0002A7A1EB39BC8A11339C7A9433A948337761BE73BC497B8E58736DA4636538AD282D3CD3DBDF0403010001DF0314F6014F477B55494C6293391DAE226D9399C8ABED");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("9F0605A0000099999F2201E4DF0803000000DF050420201231DF060101DF070100DF028180CBF2E40F0836C9A5E390A37BE3B809BDF5D740CB1DA38CFC05D5F8D6B7745B5E9A3FA6961E55FF20412108525E66B970F902F7FF4305DD832CD0763E3AA8B8173F84777100B1047BD1D744509312A0932ED25FED52A959430768CCD902FD8C8AD9123E6ADDB3F34B92E7924D729CB6473533AE2B2B55BF0E44964FDEA8440117DF040103DF0314EC8C17C8164CA0947B76B37B0EF1C937ADF32E83");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("9F0605A0000099999F2201E5DF0803000000DF050420201231DF060101DF070100DF028180D4FDAE94DEDBECC6D20D38B01E91826DC6954338379917B2BB8A6B36B5D3B0C5EDA60B337448BAFFEBCC3ABDBA869E8DADEC6C870110C42F5AAB90A18F4F867F72E3386FFC7E67E7FF94EBA079E531B3CF329517E81C5DD9B3DC65DB5F9043190BE0BE897E5FE48ADF5D3BFA0585E076E554F26EC69814797F15669F4A255C13DF040103DF031412322FD73D5A5933C08A4B28A617FB689B121D58");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("9F0605A0000099999F2201E6DF0803000000DF050420201231DF060101DF070100DF028180EBF9FAECC3E5C315709694664775D3FBDA5A504D89344DD920C55696E891D9AB622598A9D6AB8FBF35E4599CAB7EB22F956992F8AB2E6535DECB6B576FA0675F97C23DD4C374A66E6AF419C9D204D0B9F93C08D789D63805660FBB629DF1B488CFA1D7A13E9B729437EEAFE718EFA859348BA0D76812A99F31CD364F2A4FD42FDF0403010001DF0314ED85361CBB8E2109C8F9BB4F559D37844325CD9E");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("9F0605A0000000049F2201FEDF0803000000DF050420201231DF060101DF070100DF028190E76317965175A08BEE510F58830E87B262C70D529803245FA8B88E0C753562DE7AEB5A9E3E6C1A98E94D8DB7C31407DAC5D071E06B80B09E146F22DB85F1D72D1EA18D22600032C6DD40E3714D5ADA7DE9D7D01E88391F893156D6F4BF13E9063559DA0786DE9BDE6B1C9B0BB968EDDE07145ABF877B931682CCB1FB800728724D04AF241E2827E0FA1F62591914FF25DF0403010001DF0314D25FF86975B32EFDFF900C18A93C30D7531EC7BB");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("9F0605A0000000049F2201FCDF0803000000DF050420201231DF060101DF070100DF0281F8B3296C91F4795BD97112606903407B6EFF3AB39246E91095E51D17867DA4ADE59A48BE2FE9B52710283D3D32260E2C7D247214C57D46AA6465E47E0A4B3FFAAD8A7F6A190755BCCFE3F3FB3989A9F6B1C9E1845BCCCAD6F20B1DAC6033600234E81DAC4153212B0F760C23099192AA6C4C9083BEFFD9A79D2A27B08FECC8E5D437D6C68550A839B1294151DABA9D9CB2F160F60F749289F500C8C7F334BD20EBAC4AB109CF3C182F1B781C7C097A7903530746C449B99E39E4DB6493DD2A02E37C62AE8BC9A7470ECCCF8DC06A18C33CD24B30D56F25D2755CE82AA4DE4D2EAEC07750A03DB75EBD0D8EBC9F2A1D85A0D252EFF40329BE05DF0403010001DF031482CBE94F29929847E749231D8DD99895BBC198EE");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("9F0605A0000000049F2201FDDF0803000000DF050420201231DF060101DF070100DF028190C9485DBEB5E40415D1B397524F47685F306CFDC499D4E2E7D0CBAF222CFA8184BD111DAEEDC9CC6EC8540C3F7271EA9990119CC5C43180501D9F45252D6835053FAE35696AE8CD67A325647449CF5E594DA8F627209F7F03AE8D6DFC0DB3E79E28E415DF29A5B57D6814856CC30A96DA5B8890363E507FCB2E283DA1EBB5F18E8E24102B7D0192BB8E35A4F7CD05A435DF0403010001DF0314EE213BE58C49768729D342EF567F831FCF8ED675");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("9F0605A0000000049F2201FBDF0803000000DF050420201231DF060101DF070100DF0281909B170603A489C7546C45DA57B8FFD1DB2061240F0E8C6D1F9ABDC6B265AA8911915C1A4EABD8D0ED4755D1B902BA06FE5A645B786CD241295517D44EF1A7C25D75AFE0EB28066E4D69FEE7ABAFDD5EEB230F14E402C9840825FA77EAD12B5F1C5494701DE1897F65FE6BF106D47545EBF70CE7C158068C61F0773534DB742AB83C28038C1494F15905D0AD17CF1BD38DDF0403010001DF03146DAB76FCB2A99F0C305BB3B2483AD998ABE03741");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("9F0605A0000000049F2201FADF0803000000DF050420201231DF060101DF070100DF0281F8A4203E0C7BEB27097B63C103C19FDCDA671AEA7F813065756F3B9B81810CBD4BC4DEC548FBF1F3CDAE51F847235CBF2C8BADD8ACA7C93BEA3D44E80ED6A7B70E29622619DB420ACCCE07E1DD4E6C354F359FBDC9C5B70813926F77D827E52B19DAF09BFAE5274438BB8F61D17753C9EC0A8EFA3B7E46F02692160D2653CDBCC71B7D48BD37968316EB444F6504B9421B7DD3035A2C117D8B1F76A8975440DA9563618102397B881CEF8ADA7689EDFACE32482A2DFFED656E7F951DB841DA78368C6293BFC1053A86A845BFA6578E4B69F100B42B558FDE1AECEC6D250741BC783AA8A68A4261E7BB9246B10587A498D68DD955CE8B2B2433DF0403010001DF03147991D6A7DC5E141950B77800C0E838C636E31EA8");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("9F0605A0000000049F2201FFDF0803000000DF050420201231DF060101DF070100DF028190F69DBB5E15983EAE3CCF31CF4E47098C2FC16F97A0C710F84777EFA99622D86502B138728AB12E3481A84D20E014AD2D634D2836F27F294924B895A87F91F81B8169D4DFDAD8D7CBD741804CD61B467C7A9ACFECEB71188CAA73A907547699D45C9C7D2098AC2966266417F665A46BDD012C097DBD33D1D11AFF6EC8A9C0AD814A65B48262CA011636079A328C1AAEB7DF0403010001DF0314741767D70855E9573FD70A713D02BA015BC322F2");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("9F0605A0000000659F220102DF0803000000DF050420201231DF060101DF070100DF028180BB7F51983FD8707FD6227C23DEF5D5377A5A737CEF3C5252E578EFE136DF87B50473F9341F1640C8D258034E14C16993FCE6C6B8C3CEEB65FC8FBCD8EB77B3B05AC7C4D09E0FA1BA2EFE87D3184DB6718AE41A7CAD89B8DCE0FE80CEB523D5D647F9DB58A31D2E71AC677E67FA6E75820736C9893761EE4ACD11F31DBDC349EFDF0403010001DF03143FF581945EEF2DC065BE94A2D51E09801B3C809C");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("9F0605A0000000659F220103DF0803000000DF050420201231DF060101DF070100DF0281F8C9E6C1F3C6949A8A42A91F8D0224132B2865E6D953A5B5A54CFFB0412439D54AEBA79E9B399A6C104684DF3FB727C7F55984DB7A450E6AA917E110A7F2343A0024D2785D9EBE09F601D592362FDB237700B567BA14BBE2A6D3D23CF1270B3DD822B5496549BF884948F55A0D308348C4B723BAFB6A7F3975AC397CAD3C5D0FC2D178716F5E8E79E75BEB1C84FA202F80E68069A984E008706B30C212305456201540787925E86A8B28B129A11AF204B387CB6EE43DB53D15A46E13901BEBD5CECF4854251D9E9875B16E82AD1C5938A972842C8F1A42EBB5AE5336B04FF3DA8B8DFBE606FCA8B9084EE05BF67950BA89897CD089F924DBCDDF040103DF031443A3151513B7ADCEB92DBEA2A262CEB336D26C83");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("9F0605A0000000039F220150DF0803000000DF050420201231DF060101DF070100DF028180D11197590057B84196C2F4D11A8F3C05408F422A35D702F90106EA5B019BB28AE607AA9CDEBCD0D81A38D48C7EBB0062D287369EC0C42124246AC30D80CD602AB7238D51084DED4698162C59D25EAC1E66255B4DB2352526EF0982C3B8AD3D1CCE85B01DB5788E75E09F44BE7361366DEF9D1E1317B05E5D0FF5290F88A0DB47DF0403010001DF0314CAF1BA5992BF70B1D47D711D180EC0A1DCEF4AD3");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("9F0605A0000000039F220151DF0803000000DF050420201231DF060101DF070100DF028190DB5FA29D1FDA8C1634B04DCCFF148ABEE63C772035C79851D3512107586E02A917F7C7E885E7C4A7D529710A145334CE67DC412CB1597B77AA2543B98D19CF2CB80C522BDBEA0F1B113FA2C86216C8C610A2D58F29CF3355CEB1BD3EF410D1EDD1F7AE0F16897979DE28C6EF293E0A19282BD1D793F1331523FC71A228800468C01A3653D14C6B4851A5C029478E757FDF040103DF0314AC816FE9DB6AFF341B7F0E94524C2506A9867ED8");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("9F0605A0000000039F220153DF0803000000DF050420201231DF060101DF070100DF0281F8BCD83721BE52CCCC4B6457321F22A7DC769F54EB8025913BE804D9EABBFA19B3D7C5D3CA658D768CAF57067EEC83C7E6E9F81D0586703ED9DDDADD20675D63424980B10EB364E81EB37DB40ED100344C928886FF4CCC37203EE6106D5B59D1AC102E2CD2D7AC17F4D96C398E5FD993ECB4FFDF79B17547FF9FA2AA8EEFD6CBDA124CBB17A0F8528146387135E226B005A474B9062FF264D2FF8EFA36814AA2950065B1B04C0A1AE9B2F69D4A4AA979D6CE95FEE9485ED0A03AEE9BD953E81CFD1EF6E814DFD3C2CE37AEFA38C1F9877371E91D6A5EB59FDEDF75D3325FA3CA66CDFBA0E57146CC789818FF06BE5FCC50ABD362AE4B80996DDF040103DF031445D85563596CD854BB89FAC11CBC524A0AC0A19C");
    //            emvOptV2.addCapk(capkV2);
    //            capkV2 = EmvUtil.hexStr2Rid("9F0605A0000000039F220196DF0803000000DF050420201231DF060101DF070100DF028180B74586D19A207BE6627C5B0AAFBC44A2ECF5A2942D3A26CE19C4FFAEEE920521868922E893E7838225A3947A2614796FB2C0628CE8C11E3825A56D3B1BBAEF783A5C6A81F36F8625395126FA983C5216D3166D48ACDE8A431212FF763A7F79D9EDB7FED76B485DE45BEB829A3D4730848A366D3324C3027032FF8D16A1E44D8DDF040103DF0314C63D0D8598AA7A5AA342FB80489C39A2A6E5A5F7");
    //            emvOptV2.addCapk(capkV2);
    //            LogUtil.e(Constant.TAG, "init AID and CAPKs success");
    //        } catch (Exception e) {
    //            e.printStackTrace();
    //            LogUtil.e(Constant.TAG, "initAIDAndRid fail");
    //        }
    //    }
    //    /** Convert Hex string AID to AidV2 */
    //    public static AidV2 hexStr2Aid(String hexStr) {
    //        AidV2 aidV2 = new AidV2();
    //        Map<String, TLV> map = TLVUtil.buildTLVMap(hexStr);
    //        TLV tlv = map.get("DF21");
    //        if (tlv != null) {
    //            aidV2.cvmLmt = ByteUtil.hexStr2Bytes(tlv.getValue());
    //        }
    //        tlv = map.get("DF20");
    //        if (tlv != null) {
    //            aidV2.termClssLmt = ByteUtil.hexStr2Bytes(tlv.getValue());
    //        }
    //        tlv = map.get("DF19");
    //        if (tlv != null) {
    //            aidV2.termClssOfflineFloorLmt = ByteUtil.hexStr2Bytes(tlv.getValue());
    //        }
    //        tlv = map.get("9F7B");
    //        if (tlv != null) {
    //            aidV2.termOfflineFloorLmt = ByteUtil.hexStr2Bytes(tlv.getValue());
    //        }
    //        tlv = map.get("9F06");
    //        if (tlv != null) {
    //            aidV2.aid = ByteUtil.hexStr2Bytes(tlv.getValue());
    //        }
    //        tlv = map.get("DF01");
    //        if (tlv != null) {
    //            aidV2.selFlag = ByteUtil.hexStr2Byte(tlv.getValue());
    //        }
    //        tlv = map.get("DF17");
    //        if (tlv != null) {
    //            aidV2.targetPer = ByteUtil.hexStr2Byte(tlv.getValue());
    //        }
    //        tlv = map.get("DF16");
    //        if (tlv != null) {
    //            aidV2.maxTargetPer = ByteUtil.hexStr2Byte(tlv.getValue());
    //        }
    //        tlv = map.get("9F1B");
    //        if (tlv != null) {
    //            aidV2.floorLimit = ByteUtil.hexStr2Bytes(tlv.getValue());
    //        }
    //        tlv = map.get("DF15");
    //        if (tlv != null) {
    //            aidV2.threshold = ByteUtil.hexStr2Bytes(tlv.getValue());
    //        }
    //        tlv = map.get("DF13");
    //        if (tlv != null) {
    //            aidV2.TACDenial = ByteUtil.hexStr2Bytes(tlv.getValue());
    //        }
    //        tlv = map.get("DF12");
    //        if (tlv != null) {
    //            aidV2.TACOnline = ByteUtil.hexStr2Bytes(tlv.getValue());
    //        }
    //        tlv = map.get("DF11");
    //        if (tlv != null) {
    //            aidV2.TACDefault = ByteUtil.hexStr2Bytes(tlv.getValue());
    //        }
    //        tlv = map.get("9F01");
    //        if (tlv != null) {
    //            aidV2.AcquierId = ByteUtil.hexStr2Bytes(tlv.getValue());
    //        }
    //        tlv = map.get("DF14");
    //        if (tlv != null) {
    //            aidV2.dDOL = ByteUtil.hexStr2Bytes(tlv.getValue());
    //        }
    //        tlv = map.get("9F09");
    //        if (tlv != null) {
    //            aidV2.version = ByteUtil.hexStr2Bytes(tlv.getValue());
    //        }
    //        tlv = map.get("9F4E");
    //        if (tlv != null) {
    //            aidV2.merchName = ByteUtil.hexStr2Bytes(tlv.getValue());
    //        }
    //        tlv = map.get("9F15");
    //        if (tlv != null) {
    //            aidV2.merchCateCode = ByteUtil.hexStr2Bytes(tlv.getValue());
    //        }
    //        tlv = map.get("9F16");
    //        if (tlv != null) {
    //            aidV2.merchId = ByteUtil.hexStr2Bytes(tlv.getValue());
    //        }
    //        tlv = map.get("9F3C");
    //        if (tlv != null) {
    //            aidV2.referCurrCode = ByteUtil.hexStr2Bytes(tlv.getValue());
    //        }
    //        tlv = map.get("9F3D");
    //        if (tlv != null) {
    //            aidV2.referCurrExp = ByteUtil.hexStr2Byte(tlv.getValue());
    //        }
    //        tlv = map.get("DFC108");
    //        if (tlv != null) {
    //            aidV2.clsStatusCheck = ByteUtil.hexStr2Byte(tlv.getValue());
    //        }
    //        tlv = map.get("DFC109");
    //        if (tlv != null) {
    //            aidV2.zeroCheck = ByteUtil.hexStr2Byte(tlv.getValue());
    //        }
    //        tlv = map.get("DFC10A");
    //        if (tlv != null) {
    //            aidV2.kernelType = ByteUtil.hexStr2Byte(tlv.getValue());
    //        }
    //        tlv = map.get("DFC10B");
    //        if (tlv != null) {
    //            aidV2.paramType = ByteUtil.hexStr2Byte(tlv.getValue());
    //        }
    //        tlv = map.get("9F66");
    //        if (tlv != null) {
    //            aidV2.ttq = ByteUtil.hexStr2Bytes(tlv.getValue());
    //        }
    //        tlv = map.get("9F1C");
    //        if (tlv != null) {
    //            aidV2.termId = ByteUtil.hexStr2Bytes(tlv.getValue());
    //        }
    //        tlv = map.get("9F1D");
    //        if (tlv != null) {
    //            aidV2.riskManData = ByteUtil.hexStr2Bytes(tlv.getValue());
    //        }
    //        tlv = map.get("DF8101");
    //        if (tlv != null) {
    //            aidV2.referCurrCon = ByteUtil.hexStr2Bytes(tlv.getValue());
    //        }
    //        tlv = map.get("DF8102");
    //        if (tlv != null) {
    //            aidV2.tDOL = ByteUtil.hexStr2Bytes(tlv.getValue());
    //        }
    //        tlv = map.get("DFC10C");
    //        if (tlv != null) {
    //            aidV2.kernelID = ByteUtil.hexStr2Bytes(tlv.getValue());
    //        }
    //        return aidV2;
    //    }
    //
    //    /** Convert Hex string RID to CapkV2 */
    //    public static CapkV2 hexStr2Rid(String hexStr) {
    //        CapkV2 capkV2 = new CapkV2();
    //        Map<String, TLV> map = TLVUtil.buildTLVMap(hexStr);
    //        TLV tlv = map.get("9F06");
    //        if (tlv != null) {
    //            capkV2.rid = ByteUtil.hexStr2Bytes(tlv.getValue());
    //        }
    //        tlv = map.get("9F22");
    //        if (tlv != null) {
    //            capkV2.index = ByteUtil.hexStr2Byte(tlv.getValue());
    //        }
    //        tlv = map.get("DF06");
    //        if (tlv != null) {
    //            capkV2.hashInd = ByteUtil.hexStr2Byte(tlv.getValue());
    //        }
    //        tlv = map.get("DF07");
    //        if (tlv != null) {
    //            capkV2.arithInd = ByteUtil.hexStr2Byte(tlv.getValue());
    //        }
    //        tlv = map.get("DF02");
    //        if (tlv != null) {
    //            capkV2.modul = ByteUtil.hexStr2Bytes(tlv.getValue());
    //        }
    //        tlv = map.get("DF04");
    //        if (tlv != null) {
    //            capkV2.exponent = ByteUtil.hexStr2Bytes(tlv.getValue());
    //        }
    //        tlv = map.get("DF05");
    //        if (tlv != null) {
    //            capkV2.expDate = ByteUtil.hexStr2Bytes(tlv.getValue());
    //        }
    //        tlv = map.get("DF03");
    //        if (tlv != null) {
    //            capkV2.checkSum = ByteUtil.hexStr2Bytes(tlv.getValue());
    //        }
    //        return capkV2;
    //    }
}